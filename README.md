# Setting up a Redis Sentinel cluster
In this example I'll show you how to setup 3 machines as Redis server and how to archieve high avaliability and redundancy.

## Before you begin
1. In the `Vagrantfile` you must specify on what interface to expose the 3 redis servers.
2. In the `/etc/redis-sentinel.conf` delete everything that comes after the 

        # Generated by CONFIG REWRITE

    And that all the `sentinel myid <ID>` are diferent across the machines

## Info
The IP are hard coded in the Vagrantfile and the ansible playbooks.

## Creating the VM
The VM can will be created by [Vagrant](https://www.vagrantup.com/).

In order to create and lauch the VM, use the following Vagrant command.

    vagrant up

Once done, destroy the vms:

    vagrant destroy

## Lauching ansible against the vagrant machines
Once the machines have been created, they have to be provvisioned.
The tool used by this example to setup the cluster is [Ansible](https://www.redhat.com/en/technologies/management/ansible).

It's possible to launch the playbook `playbook.yml` against the machines made by Vagrant using an inventory autogenerated by Vagrant specifying the inventory path:

    -i .vagrant/provisioners/ansible/inventory/vagrant_ansible_inventory

Setup the replicas

    ansible-playbook playbook-replica.yml -i .vagrant/provisioners/ansible/inventory/vagrant_ansible_inventory

## Checking installation
In order to to check if the setup works, stop the redis on the main server:

    vagrant ssh redis_main
    redis-cli -p 6379 DEBUG sleep 30

Afterward, check on all tree machines if a new leader has been elected and that it's the same on all tree

    vagrant ssh <vm name>
    redis-cli -p 26379 sentinel master redis_replica
